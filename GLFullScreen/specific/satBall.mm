#import "satBall.h"@implementation satBall- (id)init {    int i;    	if ((self = [super init])) {                for (i=0; i<NUM_SATS; ++i) {             sats[i] = [[satellite alloc] init];        }                lastCount = 0;         loaded = 0;                 oldClosest = 0;         switcher = 0;         stripeCt = 1;                maxSats = NUM_SATS;     }		return self;}- (void)setup:(sgManager*)aSG {       theSG = aSG; }- (void) takeName:(NSString*)aName {    if (lastCount<maxSats) {         [sats[lastCount] takeName: aName];     }}- (void)addSat:(satInitRec*)newbie {    int tx, ty;     mVec3 pos;         if (lastCount<maxSats) {         [sats[lastCount] reset: newbie];                [sats[lastCount]  update: 0.0];         [sats[lastCount]  getPos: &pos];             tx = random()%16;         ty = (random()%15) +1;         satInds[lastCount] = [theSG addBillboard: &pos: 400.0: tx: ty];                ++lastCount;      }} - (void)update:(double)yearFract {    int i;     mVec3 pos;        for (i=switcher; i<lastCount; i=i+stripeCt) {         [sats[i] update: yearFract];         [sats[i] getPos: &pos];        // mxApply(&xf, &pos, &p2);         // sprSetPos(&(signs[i]), p2.x, p2.y);        // sprSetPos(&(signs[i]), pos.x+160.0, pos.y+240.0);        if (i==oldClosest) {             [theSG updateBillboard: satInds[i]: &pos: 240.0];       } else {           [theSG updateBillboard: satInds[i]: &pos: 80.0];        }        // sprDraw(&(signs[i]));     }          ++switcher;     if (switcher>=stripeCt) { switcher = 0; }    }- (int)hasNewName:(mVec3*)ground:(mVec3*)dir {     mVec3 pos, numerator, sec, x2;     int closest, i, res;     double minD, d;        mvEqAdd(&x2, ground, dir);     closest = oldClosest;     [sats[closest] getPos: &pos];    mvEqSub(&sec, &pos, &x2);     mvEqCross(&numerator, dir, &sec);     mvLength3(&numerator, &minD);        for (i=switcher; i<lastCount; i=i+stripeCt) {        [sats[i] getPos: &pos];                // from the internets!        mvEqSub(&sec, &pos, &x2);         mvEqCross(&numerator, dir, &sec);         mvLength3(&numerator, &d);                if (d<minD) {             closest = i;            minD = d;        }    }            res = 0;     if (closest != oldClosest) { res = 1; oldClosest = closest; }    return res; }- (NSString*)getName { return [sats[oldClosest] getName]; }- (int)getID { return [sats[oldClosest] getID]; }@end